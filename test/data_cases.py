from dataclasses import dataclass

import numpy as np

from cxx_image_io import (DynamicMatrix, ExifMetadata, FileFormat, ImageLayout, ImageMetadata, Matrix3,
                          PixelRepresentation, PixelType, RgbColorSpace)


@dataclass
class ImageCase:
    name: str
    file: str
    npy: str | None
    sha256: str
    numpy_info: tuple
    file_info: ImageMetadata.FileInfo | None = None
    exif: ExifMetadata | None = None
    shooting_params: ImageMetadata.ShootingParams | None = None
    calibration: ImageMetadata.CalibrationData | None = None
    cameracontrol: ImageMetadata.CameraControls | None = None
    only_pixel_cmp: bool = False


TEST_CASES = [
    ImageCase(
        "raw",
        "bayer_16bit.plain16",
        "bayer_16bit_plain.npy",
        "cb05abf125b0b5688bfba6e47d95e456ce2d791fa00a7edd9a22488701070df9",
        (np.dtype('uint16'), (180, 240), 2),
        ImageMetadata.FileInfo(
            imageLayout=ImageLayout.PLANAR,
            pixelType=PixelType.BAYER_RGGB,
            pixelPrecision=16,
            fileFormat=FileFormat.PLAIN,
            pixelRepresentation=PixelRepresentation.UINT16,
            width=240,
            height=180,
        ),
    ),
    ImageCase("bmp",
              "rgb_8bit.bmp",
              "rgb_8bit_bmp.npy",
              "c3f4017b0cdfc081c7fc7dd3915b24e62a4051b728233fc5675c2c9abea583fc",
              (np.dtype('uint8'), (275, 301, 3), 3),
              ImageMetadata.FileInfo(imageLayout=ImageLayout.INTERLEAVED,
                                     pixelPrecision=8,
                                     pixelType=PixelType.RGB,
                                     pixelRepresentation=PixelRepresentation.UINT8,
                                     width=301,
                                     height=275),
              only_pixel_cmp=True),
    ImageCase("jpg",
              "rgb_8bit.jpg",
              "rgb_8bit_jpg.npy",
              "0f1dddb05d47ce7aedd708217745fdfcb80b686eb005afba6d2859a47ad5cdfa", (np.dtype('uint8'), (68, 100, 3), 3),
              ImageMetadata.FileInfo(imageLayout=ImageLayout.INTERLEAVED,
                                     pixelPrecision=8,
                                     pixelType=PixelType.RGB,
                                     pixelRepresentation=PixelRepresentation.UINT8,
                                     width=100,
                                     height=68),
              ExifMetadata(make='Canon\x00',
                           model='Canon EOS 40D\x00',
                           isoSpeedRatings=100,
                           exposureTime=ExifMetadata.Rational(1, 160),
                           focalLength=ExifMetadata.Rational(135, 1),
                           fNumber=ExifMetadata.Rational(71, 10),
                           dateTimeOriginal='2008:05:30 15:56:01\x00',
                           orientation=1,
                           software='GIMP 2.4.5\x00',
                           exposureBiasValue=ExifMetadata.SRational(0, 1)),
              only_pixel_cmp=True),
    ImageCase("png",
              "rgb_8bit.png",
              "rgb_8bit_png.npy",
              "e6f0d601a79b4e0ba75e022f55434a57e8ff98bab7ed7f5809642c1bf06844e0", (np.dtype('uint8'), (60, 180, 3), 3),
              ImageMetadata.FileInfo(imageLayout=ImageLayout.INTERLEAVED,
                                     pixelPrecision=8,
                                     pixelType=PixelType.RGB,
                                     pixelRepresentation=PixelRepresentation.UINT8,
                                     width=180,
                                     height=60),
              only_pixel_cmp=True),
    ImageCase("png_16bit",
              "gray_16bit.png",
              "gray_16bit_png.npy",
              "cb05abf125b0b5688bfba6e47d95e456ce2d791fa00a7edd9a22488701070df9", (np.dtype('uint16'), (180, 240), 2),
              ImageMetadata.FileInfo(imageLayout=ImageLayout.PLANAR,
                                     pixelPrecision=16,
                                     pixelType=PixelType.GRAYSCALE,
                                     pixelRepresentation=PixelRepresentation.UINT16,
                                     width=240,
                                     height=180),
              only_pixel_cmp=True),
    ImageCase("tif",
              "rgb_8bit.tif",
              "rgb_8bit_tif.npy",
              "0f1dddb05d47ce7aedd708217745fdfcb80b686eb005afba6d2859a47ad5cdfa", (np.dtype('uint8'), (68, 100, 3), 3),
              ImageMetadata.FileInfo(imageLayout=ImageLayout.INTERLEAVED,
                                     pixelPrecision=8,
                                     pixelType=PixelType.RGB,
                                     pixelRepresentation=PixelRepresentation.UINT8,
                                     width=100,
                                     height=68),
              ExifMetadata(make='Canon',
                           model='Canon EOS 40D',
                           isoSpeedRatings=100,
                           exposureTime=ExifMetadata.Rational(1, 160),
                           focalLength=ExifMetadata.Rational(135, 1),
                           fNumber=ExifMetadata.Rational(71, 10),
                           dateTimeOriginal='2008:05:30 15:56:01',
                           orientation=1,
                           software='GIMP 2.4.5',
                           exposureBiasValue=ExifMetadata.SRational(0, 1)),
              only_pixel_cmp=True),
    ImageCase("tif_16bit",
              "bayer_16bit.tif",
              "bayer_16bit_tif.npy",
              "cb05abf125b0b5688bfba6e47d95e456ce2d791fa00a7edd9a22488701070df9", (np.dtype('uint16'), (180, 240), 2),
              ImageMetadata.FileInfo(imageLayout=ImageLayout.PLANAR,
                                     pixelPrecision=16,
                                     pixelType=PixelType.BAYER_RGGB,
                                     pixelRepresentation=PixelRepresentation.UINT16,
                                     width=240,
                                     height=180),
              only_pixel_cmp=True),
    ImageCase("cfa",
              "bayer_16bit.cfa",
              "bayer_16bit_cfa.npy",
              "cb05abf125b0b5688bfba6e47d95e456ce2d791fa00a7edd9a22488701070df9", (np.dtype('uint16'), (180, 240), 2),
              ImageMetadata.FileInfo(imageLayout=ImageLayout.PLANAR,
                                     pixelPrecision=16,
                                     pixelType=PixelType.BAYER_RGGB,
                                     pixelRepresentation=PixelRepresentation.UINT16,
                                     width=240,
                                     height=180),
              only_pixel_cmp=True),
    ImageCase(
        "rawmipi12", "bayer_12bit.RAWMIPI12", "bayer_12bit_rawmipi.npy",
        "240e10a13e6e3dcf7e9949fa59fc270c43b06c9be90e38c739517b10d84f5b21", (np.dtype('uint16'), (300, 400), 2),
        ImageMetadata.FileInfo(fileFormat=FileFormat.RAW12,
                               imageLayout=ImageLayout.PLANAR,
                               pixelType=PixelType.BAYER_GBRG,
                               pixelPrecision=12,
                               pixelRepresentation=PixelRepresentation.UINT16,
                               width=400,
                               height=300),
        ExifMetadata(imageWidth=4080,
                     imageHeight=3072,
                     imageDescription="Raw 12 bit image",
                     make="Xiaomi",
                     model="M2102K1G",
                     orientation=1,
                     software="Impact",
                     exposureTime=ExifMetadata.Rational(1, 60),
                     fNumber=ExifMetadata.Rational(195, 100),
                     isoSpeedRatings=50,
                     dateTimeOriginal="2021:11:16 13:15:20",
                     focalLength=ExifMetadata.Rational(7590, 1000),
                     focalLengthIn35mmFilm=7,
                     brightnessValue=ExifMetadata.SRational(0, 100),
                     exposureBiasValue=ExifMetadata.SRational(0, 6)),
        ImageMetadata.ShootingParams(aperture=2.2,
                                     exposureTime=0.016631526,
                                     sensitivity=1.2,
                                     totalGain=1.001035,
                                     sensorGain=1.0,
                                     ispGain=1.001035),
        ImageMetadata.CalibrationData(blackLevel=256,
                                      whiteLevel=4095.0,
                                      vignetting=DynamicMatrix([[2.0, 1.5, 2.0], [1.5, 1.1, 1.5], [2.0, 1.5, 2.0]]),
                                      colorMatrix=Matrix3([[1.0, 1.0, 1.0], [1.0, 1.0, 1.0], [1.0, 1.0, 1.0]]),
                                      colorMatrixTarget=RgbColorSpace.SRGB),
        ImageMetadata.CameraControls(
            whiteBalance=ImageMetadata.WhiteBalance(2.223459892023346, 1.462103373540856),
            colorShading=ImageMetadata.ColorShading(DynamicMatrix([[2.0, 1.5, 2.0], [1.5, 1.0, 1.5], [2.0, 1.5, 2.0]]),
                                                    DynamicMatrix([[3.0, 2.5, 3.0], [2.5, 1.0, 2.5], [3.0, 2.5,
                                                                                                      3.0]])),
            faceDetection=[ImageMetadata.ROI(0, 0, 100, 200),
                           ImageMetadata.ROI(0, 0, 120, 180)])),
    ImageCase(
        "rawmipi10",
        "bayer_10bit.RAWMIPI",
        "bayer_10bit_rawmipi.npy",
        "4de8edeb92793be20d75136603c47e7bc8cb5ce1211d2f5ce8dfb9cebaa9a13d",
        (np.dtype('uint16'), (180, 240), 2),
        ImageMetadata.FileInfo(imageLayout=ImageLayout.PLANAR,
                               pixelPrecision=10,
                               pixelType=PixelType.BAYER_GRBG,
                               pixelRepresentation=PixelRepresentation.UINT16,
                               width=240,
                               height=180),
    ),
    ImageCase("dng",
              "bayer_12bits.dng",
              "bayer_12bits_dng.npy",
              "5ffb00590e087e2999423b25088122ad4d422e3542af75e3f116278e94effba6",
              (np.dtype('uint16'), (2314, 3474), 2),
              ImageMetadata.FileInfo(imageLayout=ImageLayout.PLANAR,
                                     pixelPrecision=12,
                                     pixelType=PixelType.BAYER_RGGB,
                                     pixelRepresentation=PixelRepresentation.UINT16,
                                     width=3474,
                                     height=2314),
              ExifMetadata(make='Canon',
                           model='Canon EOS 350D DIGITAL',
                           isoSpeedRatings=100,
                           exposureTime=ExifMetadata.Rational(1, 800),
                           focalLength=ExifMetadata.Rational(20, 1),
                           fNumber=ExifMetadata.Rational(71, 10),
                           dateTimeOriginal='2008:12:14 15:54:54',
                           orientation=1,
                           software=None,
                           exposureBiasValue=ExifMetadata.SRational(0, 1)),
              only_pixel_cmp=True),
    ImageCase(
        "yuv",
        "raw_420.yuv",
        "raw_420_yuv.npy",
        "2d050c28e96f686178913f0a07c9aaddfd6c8e346ddd824cbf5e9dd6854898b0",
        (np.dtype('uint8'), (102, 100), 2),
        ImageMetadata.FileInfo(imageLayout=ImageLayout.YUV_420,
                               pixelPrecision=0,
                               pixelType=PixelType.YUV,
                               pixelRepresentation=PixelRepresentation.UINT8,
                               fileFormat=FileFormat.PLAIN,
                               width=100,
                               height=68),
    ),
    ImageCase(
        "nv12", "raw.nv12", "raw_nv12.npy", "9364d42743d848f82f5a3b7e5065ca800b593388dbc66f8b04716781f9a6b811",
        (np.dtype('uint8'), (102, 100), 2),
        ImageMetadata.FileInfo(imageLayout=ImageLayout.NV12,
                               pixelPrecision=0,
                               pixelType=PixelType.YUV,
                               pixelRepresentation=PixelRepresentation.UINT8,
                               fileFormat=FileFormat.PLAIN,
                               width=100,
                               height=68)),
    ImageCase(
        "canon", "RAW_CANON_EOS_1DX.CR2", None, "653e6b71334bc20165326979c972ba6647dd43db31b59a6180b57a9843510fa9",
        (np.dtype('uint16'), (3584, 5344), 2),
        ImageMetadata.FileInfo(imageLayout=ImageLayout.PLANAR,
                               pixelType=PixelType.BAYER_RGGB,
                               pixelPrecision=14,
                               pixelRepresentation=PixelRepresentation.UINT16,
                               width=5344,
                               height=3584),
        ExifMetadata(make='Canon',
                     model='EOS-1D X',
                     isoSpeedRatings=1600,
                     exposureTime=ExifMetadata.Rational(1, 80),
                     focalLength=ExifMetadata.Rational(70, 1),
                     fNumber=ExifMetadata.Rational(56, 10),
                     dateTimeOriginal='2012:09:06 07:48:25',
                     orientation=1,
                     software=None,
                     exposureBiasValue=ExifMetadata.SRational(0, 1)), None,
        ImageMetadata.CalibrationData(blackLevel=2048,
                                      whiteLevel=15438,
                                      colorMatrix=Matrix3(
                                          [[1.9404515027999878, -1.1166307926177979, 0.17617927491664886],
                                           [-0.21374493837356567, 1.6440128087997437, -0.430267870426178],
                                           [0.021280933171510696, -0.5217925906181335, 1.500511646270752]])),
        ImageMetadata.CameraControls(whiteBalance=ImageMetadata.WhiteBalance(1.75390625, 1.4775390625))),
    ImageCase(
        "sony", "RAW_SONY_RX100.ARW", None, "3b15040c02acee95bbfae8b27988efa75e3761b847cc9dd3842f16f0b6754655",
        (np.dtype('uint16'), (3672, 5504), 2),
        ImageMetadata.FileInfo(imageLayout=ImageLayout.PLANAR,
                               pixelType=PixelType.BAYER_RGGB,
                               pixelPrecision=14,
                               pixelRepresentation=PixelRepresentation.UINT16,
                               width=5504,
                               height=3672),
        ExifMetadata(make='Sony',
                     model='DSC-RX100',
                     isoSpeedRatings=640,
                     exposureTime=ExifMetadata.Rational(1, 29),
                     focalLength=ExifMetadata.Rational(103, 10),
                     fNumber=ExifMetadata.Rational(18, 10),
                     dateTimeOriginal='2013:12:13 10:15:46',
                     orientation=1,
                     software=None,
                     exposureBiasValue=ExifMetadata.SRational(0, 1))),
    ImageCase(
        "nikon", "RAW_NIKON_D3X.NEF", None, "5113095837ef100d454d0230669e06c54b089aa8c075968ca59d681b7a618bd0",
        (np.dtype('uint16'), (4044, 6080), 2),
        ImageMetadata.FileInfo(imageLayout=ImageLayout.PLANAR,
                               pixelType=PixelType.BAYER_RGGB,
                               pixelPrecision=14,
                               pixelRepresentation=PixelRepresentation.UINT16,
                               width=6080,
                               height=4044),
        ExifMetadata(make='Nikon',
                     model='D3X',
                     isoSpeedRatings=100,
                     exposureTime=ExifMetadata.Rational(1, 50),
                     focalLength=ExifMetadata.Rational(70, 1),
                     fNumber=ExifMetadata.Rational(56, 10),
                     dateTimeOriginal='2008:12:01 14:52:13',
                     orientation=6,
                     software=None,
                     exposureBiasValue=ExifMetadata.SRational(0, 1))),
    ImageCase(
        "panasonic",
        "RAW_PANASONIC_LX3.RW2",
        None,
        "26bce46b8541f858c9352dc5b67dff0910f3ad3568b4fba6eb220680d761686d",
        (np.dtype('uint16'), (2250, 4060), 2),
        ImageMetadata.FileInfo(imageLayout=ImageLayout.PLANAR,
                               pixelType=PixelType.BAYER_BGGR,
                               pixelPrecision=12,
                               pixelRepresentation=PixelRepresentation.UINT16,
                               width=4060,
                               height=2250),
    ),
    ImageCase(
        "kodak",
        "RAW_KODAK_DC120.KDC",
        None,
        "3f83c8efeeb2f7ca4f5977b42f154fdcbf4e41a34d4ce9e149908f42919a2b97",
        (np.dtype('uint8'), (976, 848), 2),
        ImageMetadata.FileInfo(imageLayout=ImageLayout.PLANAR,
                               pixelType=PixelType.BAYER_GRBG,
                               pixelPrecision=8,
                               pixelRepresentation=PixelRepresentation.UINT8,
                               width=848,
                               height=976),
    ),
    ImageCase(
        "kodak_slr",
        "RAW_KODAK_DCSPRO.DCR",
        None,
        "16728a5a2afb8e13660dc49b070f5b3e372ac237c6e0a9081be237a0a53ceab2",
        (np.dtype('uint16'), (3012, 4516), 2),
        ImageMetadata.FileInfo(imageLayout=ImageLayout.PLANAR,
                               pixelType=PixelType.BAYER_GRBG,
                               pixelPrecision=12,
                               pixelRepresentation=PixelRepresentation.UINT16,
                               width=4516,
                               height=3012),
    ),
    ImageCase(
        "leica",
        "RAW_LEICA_DLUX3.RAW",
        None,
        "5e352b24ce69c5d2420ca52e48d0fdfb2a49c76241cc653b915b42c6aca92563",
        (np.dtype('uint16'), (2439, 4330), 2),
        ImageMetadata.FileInfo(imageLayout=ImageLayout.PLANAR,
                               pixelType=PixelType.BAYER_BGGR,
                               pixelPrecision=12,
                               pixelRepresentation=PixelRepresentation.UINT16,
                               width=4330,
                               height=2439),
    ),
    ImageCase(
        "olympus",
        "RAW_OLYMPUS_E3.ORF",
        None,
        "5e69f203e5062c9c760fb0aef333702c0e0d23642d2106acc3a2a63887982a22",
        (np.dtype('uint16'), (2800, 3720), 2),
        ImageMetadata.FileInfo(imageLayout=ImageLayout.PLANAR,
                               pixelType=PixelType.BAYER_RGGB,
                               pixelPrecision=12,
                               pixelRepresentation=PixelRepresentation.UINT16,
                               width=3720,
                               height=2800),
    ),
    ImageCase(
        "pentax",
        "RAW_PENTAX_KX.PEF",
        None,
        "eb3a61dd349be8d7a8ede78bfc656a819660638ab199056b19a0cd1bfd8092ec",
        (np.dtype('uint16'), (2868, 4352), 2),
        ImageMetadata.FileInfo(imageLayout=ImageLayout.PLANAR,
                               pixelType=PixelType.BAYER_BGGR,
                               pixelPrecision=12,
                               pixelRepresentation=PixelRepresentation.UINT16,
                               width=4352,
                               height=2868),
    ),
    ImageCase(
        "samsung",
        "RAW_SAMSUNG_NX300M.SRW",
        None,
        "c015a9566f86d9b5fb32febefb81ec0e56d3bc83b3ec2ce33b39b70e11880dfd",
        (np.dtype('uint16'), (3714, 5546), 2),
        ImageMetadata.FileInfo(imageLayout=ImageLayout.PLANAR,
                               pixelType=PixelType.BAYER_GRBG,
                               pixelPrecision=12,
                               pixelRepresentation=PixelRepresentation.UINT16,
                               width=5546,
                               height=3714),
    ),

    # Can add more cases here...
]
